{% extends "admin/layout.html" %}
{% block title %}User Detail{% endblock %}

{% block content %}

<!-- ===================== HEADER ===================== -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h4 class="fw-bold mb-1">User Detail</h4>
    <p class="text-muted mb-0">User profile, role, and health summary</p>
  </div>

  <a href="{{ url_for('admin.users') }}" class="btn btn-outline-secondary btn-sm">
    <i class="bi bi-arrow-left"></i> Back
  </a>
</div>

<!-- ===================== PROFILE & HEALTH ===================== -->
<div class="row g-4 mb-4">

  <!-- PROFILE -->
  <div class="col-md-4">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body">
        <h6 class="fw-semibold mb-3">Profile</h6>

        <!-- FULL NAME -->
        <div class="mb-3">
          <div class="small text-muted">Full Name</div>
          <div class="fw-semibold">{{ user.fullname }}</div>
        </div>

        <!-- EMAIL -->
        <div class="mb-3">
          <div class="small text-muted">Email</div>
          <div>{{ user.email }}</div>
        </div>

        <!-- GENDER -->
        <div class="mb-3">
          <div class="small text-muted">Gender</div>
          <div>{{ user.jenis_kelamin|capitalize }}</div>
        </div>

        <!-- ROLE -->
        <div class="mb-3">
          <div class="small text-muted">Role</div>
          {% if user.role == 'admin' %}
            <span class="badge bg-danger">Admin</span>
          {% else %}
            <span class="badge bg-secondary">User</span>
          {% endif %}
        </div>

        <!-- JOINED -->
        <div>
          <div class="small text-muted">Joined</div>
          <div>
            {{ user.created_at.strftime('%d %B %Y') if user.created_at else '-' }}
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- ===================== HEALTH SUMMARY ===================== -->
<div class="col-md-8">
  <div class="card shadow-sm border-0 h-100">
    <div class="card-body">
      <h6 class="fw-semibold mb-3">Health Summary</h6>

      {% if user.role == 'admin' %}
        <!-- ADMIN EMPTY STATE -->
        <div class="text-center text-muted py-5">
          <i class="bi bi-shield-lock fs-2 mb-3"></i>
          <p class="mb-1 fw-semibold">Admin Account</p>
          <p class="small mb-0">
            This account is used for system monitoring and does not have health data.
          </p>
        </div>
      {% else %}
        <!-- USER HEALTH DATA -->
        <div class="row g-3">

          <!-- BMI -->
          <div class="col-md-4">
            <div class="border rounded p-3 text-center h-100">
              <div class="text-muted small mb-1">BMI</div>
              {% if health and health.bmi %}
                <div class="fs-4 fw-bold">{{ health.bmi }}</div>
              {% else %}
                <div class="text-muted">N/A</div>
              {% endif %}
            </div>
          </div>

          <!-- POSTURE STATUS -->
          <div class="col-md-4">
            <div class="border rounded p-3 text-center h-100">
              <div class="text-muted small mb-1">Posture Status</div>

              {% if posture %}
                {% if posture.posture_overall == 'normal' %}
                  <span class="badge bg-success">Normal</span>
                {% else %}
                  <span class="badge bg-warning text-dark">
                    {{ posture.posture_overall|capitalize }}
                  </span>
                {% endif %}
              {% else %}
                <span class="text-muted">N/A</span>
              {% endif %}

            </div>
          </div>

          <!-- SCAN COUNT -->
          <div class="col-md-4">
            <div class="border rounded p-3 text-center h-100">
              <div class="text-muted small mb-1">Posture Scans</div>
              <div class="fs-4 fw-bold">{{ scan_count }}</div>
            </div>
          </div>

        </div>
      {% endif %}

    </div>
  </div>
</div>


          <!-- POSTURE STATUS -->
          <div class="col-md-4">
            <div class="border rounded p-3 text-center h-100">
              <div class="text-muted small mb-1">Posture Status</div>

              {% if posture %}
                {% if posture.posture_overall == 'normal' %}
                  <span class="badge bg-success">Normal</span>
                {% else %}
                  <span class="badge bg-warning text-dark">
                    {{ posture.posture_overall|capitalize }}
                  </span>
                {% endif %}
              {% else %}
                <span class="text-muted">N/A</span>
              {% endif %}

            </div>
          </div>

          <!-- SCAN COUNT -->
          <div class="col-md-4">
            <div class="border rounded p-3 text-center h-100">
              <div class="text-muted small mb-1">Posture Scans</div>
              <div class="fs-4 fw-bold">{{ scan_count }}</div>
            </div>
          </div>

        </div>

      </div>
    </div>
  </div>

</div>

<!-- ===================== QUICK ACTIONS ===================== -->
<div class="card shadow-sm border-0">
  <div class="card-body">
    <h6 class="fw-semibold mb-3">Quick Actions</h6>

    {% if user.role == 'admin' %}
      <p class="text-muted mb-0">
        No health-related actions available for admin account.
      </p>
    {% else %}
      <div class="d-flex gap-2">
        <a href="{{ url_for('admin.posture_history_index', user_id=user.id) }}" class="btn btn-primary">
        View Posture History
        </a>

        <a href="{{ url_for('admin.diet_history_index', user_id=user.id) }}"
           class="btn btn-outline-warning">
          <i class="bi bi-egg-fried"></i> Diet History
        </a>
      </div>
    {% endif %}
  </div>
</div>


{% endblock %}
